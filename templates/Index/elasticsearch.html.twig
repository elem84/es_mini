{% extends 'base.html.twig' %}

{% block title %}ElasticSearch{% endblock %}

{% block body %}

    <div class="container">
        <div class="row">
            <div class="col">

                <form class="form-inline pt-3 my-2 my-lg-0" id="form-search">

                    <label class="my-1 mr-2"><strong>Szukaj:</strong></label>
                    <input class="form-control mr-sm-2"
                           type="search"
                           id="keyword"
                           placeholder="nazwa filmu...">
                </form>

            </div>
        </div>
    </div>
    <hr>
    <div class="container" id="result-search"></div>

{% endblock %}


{% block javascripts %}

    {{ parent() }}

    <script type="text/javascript">

        var $resultSearchContainer = $('#result-search');

        $resultSearchContainer.on('click', 'a.cat', function(e) {

            e.preventDefault();

            $(this).toggleClass('selected');

            $('#keyword').trigger('input');
        })

        $('#keyword').on('input', function(e) {

            var $input = $(this);
            var genresSelected = [];

            e.preventDefault();

            $('.sidebar a.cat.selected').each(function() {

                genresSelected.push($(this).data('id'));
            });

            $.ajax({
                url: '{{ path('elasticsearch') }}',
                method: "POST",
                data: {
                    keyword: $input.val(),
                    genres_selected: genresSelected
                }
            }).done(function(response) {

                $resultSearchContainer.html(response);
            });
        }).focus();

    </script>

{% endblock %}
